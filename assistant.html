<!-- Example Mini Bot Container -->
<div class="mini-bot-container">
  <img src="mini-bot.svg" alt="Mini Bot" class="mini-bot-img" />
</div><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Assistant - AI Bot</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(120deg, #2c085f 0%, #6d1fa8 100%);
            color: #fff;
            font-family: 'Montserrat', Arial, sans-serif;
            min-height: 100vh;
            margin: 0;
            overflow-x: hidden;
        }

        /* Navigation Bar */
        .nav-bar {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .nav-logo {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5rem;
            color: #fff;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: transform 0.3s ease;
        }

        .nav-logo:hover {
            transform: scale(1.05);
        }

        .nav-links {
            display: flex;
            gap: 2rem;
        }

        .nav-link {
            color: #fff;
            text-decoration: none;
            font-size: 1rem;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .nav-link:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .nav-link::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 0;
            height: 2px;
            background: #ff4be6;
            transition: all 0.3s ease;
            transform: translateX(-50%);
        }

        .nav-link:hover::after {
            width: 80%;
        }

        /* Main Container */
        .main-container {
            display: flex;
            padding: 6rem 2rem 2rem;
            gap: 2rem;
            min-height: 100vh;
            align-items: center;
            justify-content: center;
        }

        /* Bot Card */
        .bot-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2rem;
            flex: 1;
            max-width: 500px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .bot-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent, rgba(255, 75, 230, 0.1), transparent);
            transform: translateX(-100%);
            transition: transform 0.6s ease;
        }

        .bot-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.2);
        }

        .bot-card:hover::before {
            transform: translateX(100%);
        }

        .big-bot-svg {
            width: 360px;
            height: 480px;
            filter: drop-shadow(0 0 80px #ff4be6cc) drop-shadow(0 0 32px #fff8);
            animation: bot-float 3.5s ease-in-out infinite alternate;
            transition: all 0.3s ease;
        }

        .big-bot-svg:hover {
            filter: drop-shadow(0 0 100px #ff4be6cc) drop-shadow(0 0 40px #fff8);
            transform: scale(1.02);
        }

        /* Controls Card */
        .controls-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2rem;
            flex: 1;
            max-width: 400px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2rem;
            transition: all 0.3s ease;
        }

        .controls-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.2);
        }

        .mic-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
        }

        #micBtn {
            background: linear-gradient(135deg,#ff4be6 10%,#6d1fa8 100%);
            border: none;
            border-radius: 50%;
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 18px #ff4be655,0 0px 32px #ff4be622;
            cursor: pointer;
            outline: none;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        #micBtn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transform: translateX(-100%);
            transition: transform 0.6s ease;
        }

        #micBtn:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 24px #ff4be6cc;
        }

        #micBtn:hover::before {
            transform: translateX(100%);
        }

        #micBtn:active {
            transform: scale(0.95);
        }

        #freqBar {
            width: 100%;
            height: 40px;
            background: rgba(255,255,255,0.08);
            border-radius: 12px;
            display: none;
        }

        #voiceStatus {
            color: #fff;
            font-size: 1.1rem;
            text-align: center;
            min-height: 1.5rem;
        }

        /* Animations */
        @keyframes bot-float {
            0% { transform: translateY(0) scale(1) rotate(0deg); }
            50% { transform: translateY(-15px) scale(1.02) rotate(1deg); }
            100% { transform: translateY(0) scale(1) rotate(0deg); }
        }

        @keyframes glow-pulse {
            0% { filter: drop-shadow(0 0 80px #ff4be6cc) drop-shadow(0 0 32px #fff8); }
            50% { filter: drop-shadow(0 0 100px #ff4be6cc) drop-shadow(0 0 40px #fff8); }
            100% { filter: drop-shadow(0 0 80px #ff4be6cc) drop-shadow(0 0 32px #fff8); }
        }

        .laughing { 
            animation: laugh 0.5s ease-in-out infinite;
            filter: drop-shadow(0 0 100px #ff4be6cc);
        }

        .dancing { 
            animation: dance 1s ease-in-out infinite;
            filter: drop-shadow(0 0 100px #ff4be6cc);
        }

        .sad { 
            animation: sad 2s ease-in-out infinite;
            filter: drop-shadow(0 0 80px #6d1fa8cc);
        }

        .shut-up { 
            animation: none;
            transform: scale(0.95);
            filter: drop-shadow(0 0 60px #ff4be6cc);
        }

        .thinking { 
            animation: bot-float 1s ease-in-out infinite;
            filter: drop-shadow(0 0 90px #ff4be6cc);
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .main-container {
                flex-direction: column;
                padding-top: 5rem;
            }

            .bot-card, .controls-card {
                max-width: 100%;
                width: 100%;
            }

            .big-bot-svg {
                width: 300px;
                height: 400px;
            }
        }

        @media (max-width: 768px) {
            .nav-bar {
                padding: 1rem;
            }

            .nav-links {
                gap: 1rem;
            }

            .nav-link {
                padding: 0.3rem 0.8rem;
                font-size: 0.9rem;
            }
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            z-index: 2000;
            animation: modalFadeIn 0.3s ease;
        }

        .modal-content {
            background: rgba(44, 8, 95, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2rem;
            width: 90%;
            max-width: 600px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
            animation: modalSlideIn 0.3s ease;
        }

        .modal-content h2 {
            color: #ff4be6;
            font-family: 'Orbitron', sans-serif;
            margin-bottom: 1.5rem;
            font-size: 1.8rem;
            text-align: center;
        }

        .modal-content p {
            color: #fff;
            line-height: 1.6;
            margin-bottom: 1.5rem;
            font-size: 1.1rem;
        }

        .modal-content ul {
            list-style: none;
            padding: 0;
            margin: 1rem 0;
        }

        .modal-content li {
            color: #e4d6ff;
            margin: 0.8rem 0;
            padding-left: 1.5rem;
            position: relative;
        }

        .modal-content li:before {
            content: "•";
            color: #ff4be6;
            position: absolute;
            left: 0;
        }

        /* Feedback Form Styles */
        .feedback-form {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .rating-container {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .rating-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid #ff4be6;
            color: #fff;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .rating-btn:hover, .rating-btn.active {
            background: #ff4be6;
            transform: translateY(-2px);
        }

        .feedback-textarea {
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 1rem;
            color: #fff;
            font-size: 1rem;
            resize: vertical;
            min-height: 120px;
            transition: all 0.3s ease;
        }

        .feedback-textarea:focus {
            outline: none;
            border-color: #ff4be6;
            box-shadow: 0 0 10px rgba(255, 75, 230, 0.3);
        }

        .submit-btn {
            background: linear-gradient(135deg, #ff4be6 10%, #6d1fa8 100%);
            color: #fff;
            border: none;
            padding: 1rem 2rem;
            border-radius: 25px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            align-self: center;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 75, 230, 0.3);
        }

        @keyframes modalFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translate(-50%, -60%);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%);
            }
        }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="nav-bar">
        <a href="#" class="nav-logo">
            <i class="fas fa-robot"></i>
            AI Assistant
        </a>
        <div class="nav-links">
            <a href="#" class="nav-link" id="aboutBtn">
                <i class="fas fa-info-circle"></i> About
            </a>
            <a href="#" class="nav-link" id="feedbackBtn">
                <i class="fas fa-comment-alt"></i> Feedback
            </a>
            <a href="#" class="nav-link" id="logoutBtn">
                <i class="fas fa-sign-out-alt"></i> Logout
            </a>
            <a href="#" class="nav-link minibot-nav" id="miniBotNavBtn" title="MiniBot Extension">
                <svg width="28" height="28" viewBox="0 0 48 48" fill="none" style="vertical-align:middle;">
                    <ellipse cx="24" cy="32" rx="20" ry="14" fill="#fff"/>
                    <ellipse cx="24" cy="16" rx="16" ry="16" fill="#fff"/>
                    <ellipse cx="24" cy="16" rx="10" ry="8" fill="#2c085f"/>
                    <ellipse cx="20" cy="15" rx="2" ry="2" fill="#ff4be6"/>
                    <ellipse cx="28" cy="15" rx="2" ry="2" fill="#ff4be6"/>
                </svg>
            </a>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Bot Card -->
        <div class="bot-card">
            <svg class="big-bot-svg" viewBox="0 0 440 600" fill="none">
                <!-- Glow -->
                <ellipse cx="170" cy="250" rx="130" ry="170" fill="#fff" opacity="0.25" filter="url(#glow)"/>
                <!-- Body -->
                <ellipse cx="170" cy="320" rx="110" ry="140" fill="#e4d6ff"/>
                <!-- Head -->
                <ellipse cx="170" cy="150" rx="90" ry="80" fill="#fff"/>
                <!-- Face -->
                <ellipse cx="170" cy="155" rx="70" ry="45" fill="#2c085f"/>
                <!-- Eyes (default) -->
                <path id="leftEye" d="M140 155 Q145 160 150 155" stroke="#ff4be6" stroke-width="5" stroke-linecap="round" fill="none"/>
                <path id="rightEye" d="M190 155 Q195 160 200 155" stroke="#ff4be6" stroke-width="5" stroke-linecap="round" fill="none"/>
                <!-- Antenna -->
                <ellipse cx="170" cy="65" rx="20" ry="20" fill="#fff"/>
                <ellipse cx="170" cy="55" rx="14" ry="14" fill="#ff4be6"/>
                <!-- Arms -->
                <rect id="leftArm" x="65" y="260" width="30" height="100" rx="18" fill="#fff" transform="rotate(-20 65 260)"/>
                <rect id="rightArm" x="245" y="260" width="30" height="100" rx="18" fill="#fff" transform="rotate(20 245 260)"/>
                <defs>
                    <filter id="glow" x="0" y="70" width="340" height="350" filterUnits="userSpaceOnUse">
                        <feGaussianBlur stdDeviation="36" result="coloredBlur"/>
                        <feMerge>
                            <feMergeNode in="coloredBlur"/>
                            <feMergeNode in="SourceGraphic"/>
                        </feMerge>
                    </filter>
                </defs>
            </svg>
        </div>

        <!-- Controls Card -->
        <div class="controls-card">
            <div class="mic-container">
                <button id="micBtn">
                    <svg id="micIcon" width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M12 1v14a4 4 0 0 0 4-4V5a4 4 0 0 0-8 0v6a4 4 0 0 0 4 4z"></path>
                        <line x1="19" y1="10" x2="19" y2="10"></line>
                        <line x1="5" y1="10" x2="5" y2="10"></line>
                        <line x1="12" y1="19" x2="12" y2="23"></line>
                        <line x1="8" y1="23" x2="16" y2="23"></line>
                    </svg>
                </button>
                <canvas id="freqBar" width="220" height="40"></canvas>
                <div id="voiceStatus"></div>
            </div>
        </div>
    </div>

    <!-- Modal for About -->
    <div id="aboutModal" class="modal">
        <div class="modal-content">
            <h2>About AI Assistant</h2>
            <p>This project is a smart virtual assistant that can open browser tabs, including WhatsApp and other websites, through voice commands. It can detect and respond to different emotions like happy, sad, and angry, making interactions more natural and expressive. The assistant is also capable of generating custom responses based on what the user says, offering a dynamic and personalized experience.</p>
            <ul>
                <li>Voice-controlled website navigation</li>
                <li>Emotional intelligence and responses</li>
                <li>Natural language processing</li>
                <li>Dynamic and personalized interactions</li>
            </ul>
        </div>
    </div>

    <!-- Modal for Feedback -->
    <div id="feedbackModal" class="modal">
        <div class="modal-content">
            <h2>Feedback</h2>
            <form id="feedbackForm" class="feedback-form">
                <div class="rating-container">
                    <button type="button" class="rating-btn" data-rating="1">1</button>
                    <button type="button" class="rating-btn" data-rating="2">2</button>
                    <button type="button" class="rating-btn" data-rating="3">3</button>
                    <button type="button" class="rating-btn" data-rating="4">4</button>
                    <button type="button" class="rating-btn" data-rating="5">5</button>
                </div>
                <textarea class="feedback-textarea" placeholder="Share your thoughts about the AI Assistant..." rows="4"></textarea>
                <button type="submit" class="submit-btn">Submit Feedback</button>
            </form>
        </div>
    </div>

    <!-- Floating Bot Widget -->
    <div id="floatingBotWidget" style="position:fixed; top:50%; right:32px; width:140px; height:170px; z-index:9999; cursor:grab; border-radius:32px; background:radial-gradient(circle at 60% 40%, #ff4be6 60%, #6d1fa8 100%); box-shadow:0 0 32px 8px #a84be6cc, 0 0 0 0 #fff0; display:flex; flex-direction:column; align-items:center; justify-content:center; transform:translateY(-50%); transition:box-shadow 0.2s;">
        <div style="margin-top:10px; margin-bottom:8px; display:flex; align-items:center; justify-content:center; width:100%;">
            <svg width="80" height="80" viewBox="0 0 80 80" fill="none">
                <ellipse cx="40" cy="56" rx="32" ry="20" fill="#fff"/>
                <ellipse cx="40" cy="32" rx="28" ry="28" fill="#fff"/>
                <ellipse cx="40" cy="32" rx="16" ry="12" fill="#2c085f"/>
                <ellipse cx="34" cy="30" rx="2.5" ry="2.5" fill="#ff4be6"/>
                <ellipse cx="46" cy="30" rx="2.5" ry="2.5" fill="#ff4be6"/>
                <ellipse cx="40" cy="32" rx="1.5" ry="1.5" fill="#ff4be6" opacity="0.7"/>
            </svg>
        </div>
        <div style="margin-top:8px; width:100%; display:flex; justify-content:center;">
            <div style="background:#2c085f; color:#fff; font-family:'Montserrat',Arial,sans-serif; font-size:1.35rem; font-weight:600; border-radius:18px; padding:6px 18px; box-shadow:0 2px 12px #2c085f55;">Listening...</div>
        </div>
    </div>
    <!-- MiniBot Extension Info Popup -->
    <div id="miniBotPopup" style="display:none; position:fixed; top:50px; right:40px; background:#2c085f; color:#fff; border-radius:22px; box-shadow:0 8px 48px #ff4be655; max-width:400px; width:90vw; padding:32px 28px 28px 28px; text-align:left; font-size:1.1rem; z-index:10000;">
        <button onclick="closeMiniBotPopup()" style="position:absolute; top:12px; right:18px; background:none; border:none; color:#ff4be6; font-size:2rem; cursor:pointer;">&times;</button>
        <h2 style='color:#ff4be6; font-family:Orbitron,Arial,sans-serif; font-size:1.5rem; margin-bottom:1.2rem; text-align:center;'>Install Assistant Extension</h2>
        <ol style='margin-bottom:1.2rem;'>
            <li>Click the button below to download the extension as a <b>.zip</b> file.</li>
            <li>Unzip the file on your computer.</li>
            <li>Open <b>chrome://extensions/</b> in a new Chrome tab.</li>
            <li>Turn on <b>Developer mode</b> (top right).</li>
            <li>Click <b>Load unpacked</b> and select the unzipped folder.</li>
            <li>Done! The assistant will now work across your browser.</li>
        </ol>
        <a href="assistant-extension.zip" download style="display:block; text-align:center; background:linear-gradient(90deg,#ff4be6 10%,#6d1fa8 100%); color:#fff; font-weight:700; border-radius:16px; padding:12px 0; margin:18px 0 0 0; text-decoration:none; font-size:1.1rem; box-shadow:0 2px 12px #ff4be655;">&#128229; Download Assistant Extension</a>
    </div>

    <script>
        // Add modal functionality
        document.getElementById('aboutBtn').addEventListener('click', function(e) {
            e.preventDefault();
            document.getElementById('aboutModal').style.display = 'block';
        });

        document.getElementById('feedbackBtn').addEventListener('click', function(e) {
            e.preventDefault();
            document.getElementById('feedbackModal').style.display = 'block';
        });

        document.getElementById('logoutBtn').addEventListener('click', function(e) {
            e.preventDefault();
            if (confirm('Are you sure you want to logout?')) {
                // Add logout logic here
                window.location.href = 'login.html';
            }
        });

        // Close modals when clicking outside
        window.addEventListener('click', function(e) {
            if (e.target.className === 'modal') {
                e.target.style.display = 'none';
            }
        });

        // Add API keys configuration
        const OPENAI_API_KEY = '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';
        const WEATHER_API_KEY = 'YOUR_WEATHER_API_KEY'; // Replace with your OpenWeatherMap API key

        // Voice greeting using Web Speech API
        let hasGreeted = false;
        let isRecording = false;
        let mediaStream = null;
        let audioContext = null;
        let recognition = null;
        let analyser, dataArray, source, animationId;
        let isSpeaking = false;

        // Add function to get weather data with enhanced error handling
        async function getWeather(city) {
            try {
                const response = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${WEATHER_API_KEY}&units=metric`);
                const data = await response.json();
                
                if (data.cod === 200) {
                    return {
                        temperature: Math.round(data.main.temp),
                        description: data.weather[0].description,
                        city: data.name,
                        humidity: data.main.humidity,
                        windSpeed: Math.round(data.wind.speed)
                    };
                }
                throw new Error('City not found');
            } catch (error) {
                console.error('Weather API Error:', error);
                return null;
            }
        }

        // Add function to get AI response with enhanced error handling
        async function getAIResponse(prompt) {
            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${OPENAI_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: "gpt-3.5-turbo",
                        messages: [{
                            role: "system",
                            content: "You are a helpful AI assistant. Provide clear, concise, and accurate responses. For weather queries, focus on providing current conditions and temperature. For general questions, be informative and engaging."
                        }, {
                            role: "user",
                            content: prompt
                        }],
                        max_tokens: 200,
                        temperature: 0.7
                    })
                });

                if (!response.ok) {
                    throw new Error(`API request failed with status ${response.status}`);
                }

                const data = await response.json();
                if (data.choices && data.choices[0] && data.choices[0].message) {
                    return data.choices[0].message.content;
                } else {
                    throw new Error('Invalid response format from API');
                }
            } catch (error) {
                console.error('OpenAI API Error:', error);
                return "I'm having trouble connecting to my knowledge base. Please try again in a moment.";
            }
        }

        // Add function to handle speech completion
        function speakAndWait(text) {
            return new Promise((resolve) => {
            if ('speechSynthesis' in window) {
                    const utter = new SpeechSynthesisUtterance(text);
                utter.lang = 'en-US';
                utter.rate = 1;
                utter.pitch = 1.1;
                    
                    utter.onend = () => {
                        isSpeaking = false;
                        resolve();
                    };
                    
                    utter.onerror = () => {
                        isSpeaking = false;
                        resolve();
                    };
                    
                    isSpeaking = true;
                    window.speechSynthesis.speak(utter);
                } else {
                    resolve();
                }
            });
        }

        function playGreeting() {
            if (hasGreeted) return;
            const greeting = "Hi! I am your AI assistant. How can I help you today?";
            speakAndWait(greeting);
            hasGreeted = true;
        }

        // Microphone and frequency visualization
        const micBtn = document.getElementById('micBtn');
        const micIcon = document.getElementById('micIcon');
        const freqBar = document.getElementById('freqBar');
        const voiceStatus = document.getElementById('voiceStatus');

        function drawFrequency() {
            if (!analyser) return;
            const ctx = freqBar.getContext('2d');
            analyser.getByteFrequencyData(dataArray);
            ctx.clearRect(0, 0, freqBar.width, freqBar.height);
            const barWidth = (freqBar.width / dataArray.length) * 2.5;
            let x = 0;
            for (let i = 0; i < dataArray.length; i++) {
                const barHeight = dataArray[i] / 2;
                ctx.fillStyle = `rgba(255,75,230,${0.5 + barHeight/128})`;
                ctx.fillRect(x, freqBar.height - barHeight, barWidth, barHeight);
                x += barWidth + 1;
            }
            animationId = requestAnimationFrame(drawFrequency);
        }

        async function startFrequencyViz(stream) {
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
            analyser = audioContext.createAnalyser();
            source = audioContext.createMediaStreamSource(stream);
            source.connect(analyser);
            analyser.fftSize = 32;
            dataArray = new Uint8Array(analyser.frequencyBinCount);
            freqBar.style.display = 'block';
            drawFrequency();
        }

        function stopFrequencyViz() {
            if (animationId) cancelAnimationFrame(animationId);
            if (audioContext) audioContext.close();
            freqBar.style.display = 'none';
        }

        // Initialize speech recognition
        if ('webkitSpeechRecognition' in window) {
            recognition = new webkitSpeechRecognition();
            recognition.continuous = false;
            recognition.interimResults = false;
        }

        // Initialize audio context
        function initAudioContext() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
            return audioContext;
        }

        // Clean up resources
        function cleanupResources() {
            if (mediaStream) {
                mediaStream.getTracks().forEach(track => track.stop());
                mediaStream = null;
            }
            if (audioContext && audioContext.state !== 'closed') {
                audioContext.close();
                audioContext = null;
            }
            stopFrequencyViz();
        }

        micBtn.addEventListener('click', async function() {
            // If bot is speaking, stop it
            if (isSpeaking) {
                window.speechSynthesis.cancel();
                isSpeaking = false;
            }

            // Play greeting on first mic button click if not already played
            if (!hasGreeted) {
                playGreeting();
            }

            if (isRecording) {
                // Stop recording
                isRecording = false;
                micBtn.style.background = 'linear-gradient(135deg,#ff4be6 10%,#6d1fa8 100%)';
                voiceStatus.textContent = '';
                if (recognition) {
                    recognition.stop();
            }
                cleanupResources();
                return;
            }

            // Start recording
            isRecording = true;
            micBtn.style.background = '#ff4be6';
            voiceStatus.textContent = 'Listening...';

            try {
                // Initialize audio context
                initAudioContext();
                
                // Get microphone access
                mediaStream = await navigator.mediaDevices.getUserMedia({ audio: true });
                startFrequencyViz(mediaStream);

                // Start recognition if not already started
                if (recognition && !recognition.started) {
                    recognition.start();
                    recognition.started = true;
                }
            } catch (e) {
                console.error('Error:', e);
                voiceStatus.textContent = 'Microphone access denied.';
                isRecording = false;
                micBtn.style.background = 'linear-gradient(135deg,#ff4be6 10%,#6d1fa8 100%)';
                cleanupResources();
            }
        });

        if (recognition) {
            recognition.onresult = async function(event) {
                const transcript = event.results[0][0].transcript.toLowerCase();
                voiceStatus.textContent = `You said: "${transcript}"`;
                
                // Process commands
                let responseText = '';
                const botSvg = document.querySelector('.big-bot-svg');
                const leftEye = document.getElementById('leftEye');
                const rightEye = document.getElementById('rightEye');
                const leftArm = document.getElementById('leftArm');
                const rightArm = document.getElementById('rightArm');

                // Show thinking animation
                botSvg.classList.add('thinking');
                voiceStatus.textContent = "Processing...";

                try {
                    // Handle weather queries
                    if (transcript.includes('weather')) {
                        // Extract city name from the query
                        const cityMatch = transcript.match(/weather (?:in|at|for)?\s*([a-zA-Z\s]+)/i);
                        if (cityMatch && cityMatch[1]) {
                            const city = cityMatch[1].trim();
                            voiceStatus.textContent = `Checking weather for ${city}...`;
                            
                            const weatherData = await getWeather(city);
                            if (weatherData) {
                                responseText = `The weather in ${weatherData.city} is ${weatherData.temperature}°C with ${weatherData.description}. Humidity is ${weatherData.humidity}% and wind speed is ${weatherData.windSpeed} meters per second.`;
                            } else {
                                responseText = `Sorry, I couldn't find the weather for ${city}. Please check the city name and try again.`;
                            }
                        } else {
                            responseText = "Please specify a city. For example, 'What's the weather in London?'";
                        }
                    }
                    // Handle emotional commands
                    else if (transcript.includes('laugh') || transcript.includes('happy')) {
                        // Laughing animation
                        botSvg.classList.add('laughing');
                        // Change eyes to happy
                        leftEye.setAttribute('d', 'M140 155 Q145 150 150 155');
                        rightEye.setAttribute('d', 'M190 155 Q195 150 200 155');
                        // Move arms up
                        leftArm.setAttribute('transform', 'rotate(-40 65 260)');
                        rightArm.setAttribute('transform', 'rotate(40 245 260)');
                        
                        // Play laughing sound
                        const laughSound = new Audio('data:audio/wav;base64,UklGRl9vT19XQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YU');
                        laughSound.play();
                        
                        responseText = "Haha! That's funny!";
                    }
                    else if (transcript.includes('dance')) {
                        // Dancing animation
                        botSvg.classList.add('dancing');
                        // Change eyes to excited
                        leftEye.setAttribute('d', 'M140 155 Q145 150 150 155');
                        rightEye.setAttribute('d', 'M190 155 Q195 150 200 155');
                        // Move arms in dancing motion
                        leftArm.setAttribute('transform', 'rotate(-60 65 260)');
                        rightArm.setAttribute('transform', 'rotate(60 245 260)');
                        
                        responseText = "Let's dance!";
                    }
                    else if (transcript.includes('sad')) {
                        // Sad animation
                        botSvg.classList.add('sad');
                        // Change eyes to sad
                        leftEye.setAttribute('d', 'M140 155 Q145 160 150 155');
                        rightEye.setAttribute('d', 'M190 155 Q195 160 200 155');
                        // Move arms down
                        leftArm.setAttribute('transform', 'rotate(0 65 260)');
                        rightArm.setAttribute('transform', 'rotate(0 245 260)');
                        
                        responseText = "I'm feeling sad...";
                    }
                    else if (transcript.includes('shut up')) {
                        // Shut up animation
                        botSvg.classList.add('shut-up');
                        // Change eyes to angry
                        leftEye.setAttribute('d', 'M140 155 Q145 153 150 155');
                        rightEye.setAttribute('d', 'M190 155 Q195 153 200 155');
                        // Move arms to sides
                        leftArm.setAttribute('transform', 'rotate(-10 65 260)');
                        rightArm.setAttribute('transform', 'rotate(10 245 260)');
                        
                        responseText = "Okay, I'll be quiet...";
                    }
                    // Handle website opening commands
                    else if (transcript.includes('open')) {
                        // Clean up the transcript
                        let cleanTranscript = transcript.toLowerCase()
                            .replace(/please|can you|could you|would you|i want you to|i need to|for me|on another tab|in another tab|in a new tab|on a new tab/gi, '')
                            .trim();

                        // Extract website name from the sentence
                        let website = '';
                        const words = cleanTranscript.split(' ');
                        const openIndex = words.indexOf('open');
                        
                        if (openIndex !== -1 && words[openIndex + 1]) {
                            // Get the word after 'open'
                            website = words[openIndex + 1].toLowerCase();
                        } else {
                            // Try to extract website name from the whole sentence
                            website = cleanTranscript.replace(/.*open\s+/i, '').trim().toLowerCase();
                        }

                        // Remove any remaining common words
                        website = website.replace(/\s+(for|me|on|in|a|new|tab)$/i, '').trim();

                        let url = '';
                        let siteName = '';
                        
                        // Map common websites to their URLs
                        switch(website) {
                            case 'youtube':
                                url = 'https://www.youtube.com';
                                siteName = 'YouTube';
                                break;
                            case 'google':
                                url = 'https://www.google.com';
                                siteName = 'Google';
                                break;
                            case 'facebook':
                                url = 'https://www.facebook.com';
                                siteName = 'Facebook';
                                break;
                            case 'twitter':
                                url = 'https://www.twitter.com';
                                siteName = 'Twitter';
                                break;
                            case 'instagram':
                                url = 'https://www.instagram.com';
                                siteName = 'Instagram';
                                break;
                            case 'whatsapp':
                                url = 'https://web.whatsapp.com';
                                siteName = 'WhatsApp';
                                break;
                            case 'netflix':
                                url = 'https://www.netflix.com';
                                siteName = 'Netflix';
                                break;
                            case 'chrome':
                            case 'tab':
                            case 'new tab':
                                url = 'chrome://newtab/';
                                siteName = 'new Chrome tab';
                                break;
                            default:
                                // Try to open as a generic website
                                url = `https://www.${website}.com`;
                                siteName = website;
                        }
                        
                        // Open the website in Chrome
                        if (url) {
                            try {
                                // Open website in a new tab
                                window.open(url, '_blank');
                                
                                // Provide voice confirmation
                if ('speechSynthesis' in window) {
                                    const utter = new SpeechSynthesisUtterance(`Opening ${siteName}`);
                    utter.lang = 'en-US';
                    utter.rate = 1;
                    utter.pitch = 1.1;
                    window.speechSynthesis.speak(utter);
                }
                            } catch (e) {
                                console.error('Error opening website:', e);
                                // If opening fails, try alternative method
                                const link = document.createElement('a');
                                link.href = url;
                                link.target = '_blank';
                                link.click();
                            }
                        }
                        
                        isRecording = false;
                        micBtn.style.background = 'linear-gradient(135deg,#ff4be6 10%,#6d1fa8 100%)';
                        cleanupResources();
                        return;
                    }
                    // Handle general questions using AI
                    else {
                        const aiResponse = await getAIResponse(transcript);
                        responseText = aiResponse;
                    }
                } catch (error) {
                    console.error('Error processing request:', error);
                    responseText = "I'm sorry, I encountered an error while processing your request. Please try again.";
                } finally {
                    // Remove thinking animation
                    botSvg.classList.remove('thinking');
                }

                // Wait for speech to complete before resetting
                await speakAndWait(responseText);
                
                isRecording = false;
                micBtn.style.background = 'linear-gradient(135deg,#ff4be6 10%,#6d1fa8 100%)';
                cleanupResources();
            };

            recognition.onerror = function(event) {
                console.error('Recognition error:', event.error);
                voiceStatus.textContent = 'Voice recognition error.';
                isRecording = false;
                micBtn.style.background = 'linear-gradient(135deg,#ff4be6 10%,#6d1fa8 100%)';
                cleanupResources();
            };

            recognition.onend = function() {
                if (isRecording) {
                    isRecording = false;
                    micBtn.style.background = 'linear-gradient(135deg,#ff4be6 10%,#6d1fa8 100%)';
                    voiceStatus.textContent = '';
                    cleanupResources();
                }
                recognition.started = false;
            };
        }

        // Add rating functionality
        const ratingBtns = document.querySelectorAll('.rating-btn');
        let selectedRating = 0;

        ratingBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                const rating = this.dataset.rating;
                selectedRating = rating;
                
                // Remove active class from all buttons
                ratingBtns.forEach(b => b.classList.remove('active'));
                
                // Add active class to selected button and all previous buttons
                ratingBtns.forEach((b, index) => {
                    if (index < rating) {
                        b.classList.add('active');
                    }
                });
            });
        });

        // Handle feedback form submission
        document.getElementById('feedbackForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const feedback = this.querySelector('textarea').value;
            
            if (selectedRating === 0) {
                alert('Please select a rating');
                return;
            }

            // Here you would typically send the feedback to your server
            console.log('Rating:', selectedRating);
            console.log('Feedback:', feedback);
            
            // Show success message
            alert('Thank you for your feedback!');
            
            // Reset form and close modal
            this.reset();
            selectedRating = 0;
            ratingBtns.forEach(btn => btn.classList.remove('active'));
            document.getElementById('feedbackModal').style.display = 'none';
        });

        // --- Floating Widget Drag & Persist ---
        const widget = document.getElementById('floatingBotWidget');
        let offsetX, offsetY, isDragging = false;
        // Restore position
        const savedPos = JSON.parse(localStorage.getItem('botWidgetPos'));
        if(savedPos) {
            widget.style.right = '';
            widget.style.top = '';
            widget.style.left = savedPos.left;
            widget.style.top = savedPos.top;
            widget.style.transform = '';
        }
        widget.addEventListener('mousedown', function(e) {
            isDragging = true;
            offsetX = e.clientX - widget.getBoundingClientRect().left;
            offsetY = e.clientY - widget.getBoundingClientRect().top;
            widget.style.transition = 'none';
            document.body.style.userSelect = 'none';
        });
        document.addEventListener('mousemove', function(e) {
            if(isDragging) {
                let left = e.clientX - offsetX;
                let top = e.clientY - offsetY;
                widget.style.left = left + 'px';
                widget.style.top = top + 'px';
                widget.style.right = '';
                widget.style.bottom = '';
                widget.style.transform = '';
            }
        });
        document.addEventListener('mouseup', function(e) {
            if(isDragging) {
                isDragging = false;
                widget.style.transition = '';
                localStorage.setItem('botWidgetPos', JSON.stringify({left: widget.style.left, top: widget.style.top}));
                document.body.style.userSelect = '';
            }
        });
        // --- Remove on Double Click (with Cross) ---
        let removeMode = false;
        widget.addEventListener('dblclick', function() {
            if(!removeMode) {
                widget.innerHTML = '<span id="closeBot" style="font-size:2.2rem;color:#ff4be6;user-select:none;">&times;</span>';
                removeMode = true;
            } else {
                widget.remove();
                localStorage.removeItem('botWidgetPos');
                document.getElementById('extensionPopup').style.display = 'none';
            }
        });
        widget.addEventListener('mouseleave', function() {
            if(removeMode) {
                widget.innerHTML = `<div style=\"margin-top:12px; margin-bottom:8px;\"><svg width=\"48\" height=\"48\" viewBox=\"0 0 48 48\" fill=\"none\"><ellipse cx=\"24\" cy=\"32\" rx=\"20\" ry=\"14\" fill=\"#fff\"/><ellipse cx=\"24\" cy=\"16\" rx=\"16\" ry=\"16\" fill=\"#fff\"/><ellipse cx=\"24\" cy=\"16\" rx=\"10\" ry=\"8\" fill=\"#2c085f\"/><ellipse cx=\"20\" cy=\"15\" rx=\"2\" ry=\"2\" fill=\"#ff4be6\"/><ellipse cx=\"28\" cy=\"15\" rx=\"2\" ry=\"2\" fill=\"#ff4be6\"/></svg></div><div style=\"font-family:'Orbitron',Arial,sans-serif;font-size:1.3rem;font-weight:700;color:#fff;\">Bot</div>`;
                removeMode = false;
            }
        });
        // --- Show Extension Popup on Click ---
        widget.addEventListener('click', function(e) {
            if(removeMode) return;
            if(e.detail === 1) {
                setTimeout(() => {
                    if(!removeMode) showExtensionPopup();
                }, 200);
            }
        });
        function showExtensionPopup() {
            document.getElementById('extensionPopup').style.display = 'block';
        }
        function closeExtensionPopup() {
            document.getElementById('extensionPopup').style.display = 'none';
        }
        // --- Keep Widget on Tab Change ---
        window.addEventListener('beforeunload', function() {
            localStorage.setItem('botWidgetPos', JSON.stringify({left: widget.style.left, top: widget.style.top}));
        });

        // MiniBot Navbar Popup Logic
        const miniBotBtn = document.getElementById('miniBotNavBtn');
        const miniBotPopup = document.getElementById('miniBotPopup');
        miniBotBtn.addEventListener('click', function(e) {
            e.preventDefault();
            miniBotPopup.style.display = 'block';
        });
        function closeMiniBotPopup() {
            miniBotPopup.style.display = 'none';
        }
    </script>
</body>
</html> 